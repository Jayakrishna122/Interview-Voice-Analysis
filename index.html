<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interview Voice Analysis</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 800px;
            margin: 50px auto;
            background: #fff;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        h1 {
            text-align: center;
            color: #444;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }

        input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }

        button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .results {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            border-radius: 5px;
        }

        .results h3 {
            margin-top: 0;
        }

        #uploaded-audio {
            width: 100%;
            margin-top: 10px;
            display: none;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Interview Voice Analysis</h1>
    <form id="analysis-form">
        <div class="form-group">
            <label for="audio-file">Upload Interview Audio:</label>
            <input type="file" id="audio-file" accept="audio/*" required>
        </div>
        <button type="submit">Analyze Audio</button>
    </form>

    
    <audio id="uploaded-audio" controls style="display: none;"></audio>

    <div id="results" class="results" style="display: none;">
        <h3>Analysis Results</h3>
        <div class="result-item"><strong>Sentiment:</strong> <span id="sentiment"></span></div>
        <div class="result-item"><strong>Average Pitch:</strong> <span id="avg-pitch"></span></div>
        <div class="result-item"><strong>Speech Tempo:</strong> <span id="tempo"></span></div>
        <div class="result-item"><strong>Word Count:</strong> <span id="word-count"></span></div>
        <div class="result-item"><strong>Relevant Keywords:</strong> <span id="keywords-match"></span></div>
        <div class="result-item"><strong>Stress Level:</strong> <span id="stress-level"></span></div>
        <div class="result-item"><strong>Clarity:</strong> <span id="clarity"></span></div>
    </div>
    
</div>

<script>
    document.getElementById('analysis-form').addEventListener('submit', async function(event) {
        event.preventDefault();
    
    const formData = new FormData();
    const audioFile = document.getElementById('audio-file').files[0];
    
    if (!audioFile) {
        alert("Please upload an audio file.");
        return;
    }
    
    formData.append('audio', audioFile);
    
    try {
    // Step 1: Send the file to the Node.js server
    const uploadResponse = await fetch('http://localhost:3000/upload', {
        method: 'POST',
        body: formData
    });

    if (!uploadResponse.ok) {
        throw new Error('Failed to upload audio file.');
    }

    const uploadData = await uploadResponse.json();

    if (uploadData.error) {
        alert(uploadData.error);
        return;
    }

    const filePath = uploadData.file_path; // The path returned by the server
    console.log("Uploaded file path: ", filePath);

    // Step 2: Display the uploaded audio file
    const audioPlayer = document.getElementById('uploaded-audio');
    audioPlayer.src = `http://localhost:3000/uploads/${filePath}`; // Construct the URL to play the file
    audioPlayer.style.display = 'block';
    alert("Please wait while processing.");
    // Step 3: Send file path to Flask for analysis
    const flaskBaseURL = "http://127.0.0.1:5000"; 
    const analysisResponse = await fetch(`${flaskBaseURL}/analyze`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ file_path: filePath })  // Send only the relative file path
    });

    if (!analysisResponse.ok) {
        throw new Error('Failed to fetch analysis results.');
    }

    alert("Please wait while processing.");

    const jsonResponse = await analysisResponse.json();
    const results = jsonResponse;
    console.log(results);

    // Step 4: Display results
    document.getElementById('sentiment').innerText = results.sentiment || "N/A";
    document.getElementById('avg-pitch').innerText = results.average_pitch || "N/A";
    document.getElementById('tempo').innerText = results.speech_tempo || "N/A";
    document.getElementById('word-count').innerText = results.word_count || "N/A";
    document.getElementById('keywords-match').innerText = results.relevant_keywords ? results.relevant_keywords.join(', ') : "N/A";
    document.getElementById('stress-level').innerText = results.stress_level || "N/A";
    document.getElementById('clarity').innerText = results.clarity || "N/A";
    document.getElementById('results').style.display = 'block';

} catch (error) {
    console.error('Error:', error);
    alert(error.message); // Use error.message to ensure it's a clean message
}

    });
    </script>
    

</body>
</html>
